{% extends "_base.html" %}
{% block title %}
    My Orders
{% endblock title %}
{% load static %}
{% block content %}
{% include 'recipient_orders/review_modal.html' %}
<div class="container">
    <h1 class="title">Hi, {{ user.first_name }} {{ user.last_name }}!</h1>
    <h2 class="subtitle mt-3">Your reservations:</h2>
    <!--Tab Navigation Bar-->
    <div class="tabs is-centered is-toggle is-fullwidth">
        <ul>
            <li class="is-active" id="pending-tab">
                <a>
                    <span>Pending</span>
                </a>
            </li>
            <li id="picked-up-tab">
                <a>
                    <span>Picked Up</span>
                </a>
            </li>
            <li id="canceled-tab">
                <a>
                    <span>Canceled</span>
                </a>
            </li>
        </ul>
    </div>

    <div id="pending-orders" class="order-list">
        {% if pending_orders %}
            <div class="columns is-multiline is-variable is-4">
                {% for order in pending_orders %}
                    <div class="column is-full-mobile is-half-tablet is-half-desktop">
                        <div class="card mb-5">
                            <div class="card-content">
                                <div class="media is-flex is-justify-content-space-between is-flex-direction-column-mobile">
                                    <div class="media-content">
                                        <p class="title is-4 is-clipped">{{ order.donation.food_item }}</p>
                                    </div>
                                    <div class="media-right mt-2-mobile">
                                        <span class="tag is-primary is-light is-medium mt-1">{{ order.order_quantity }} reserved</span>
                                    </div>
                                </div>
                                <div class="content">
                                    <div class="columns is-flex-direction-column-mobile">
                                        <div class="column is-two-thirds">
                                            <a class="button is-link is-light is-fullwidth"
                                               style="white-space: normal; word-wrap: break-word"
                                               href="https://www.google.com/maps/dir/?api=1&destination={{ order.donation.organization.address|urlencode }}"
                                               target="_blank"
                                               rel="noopener noreferrer">
                                                {{ order.donation.organization.organization_name }}
                                                <br>
                                                {{ order.donation.organization.address }}
                                            </a>
                                        </div>
                                        <div class="column is-one-third has-text-centered">
                                            <strong>Pickup by:</strong>
                                            <p>{{ order.donation.pickup_by }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <footer class="card-footer">
                                <a href="#" class="card-footer-item">Modify</a>
                                <a href="#" class="card-footer-item">Cancel</a>
                            </footer>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
        <div class="box">
            <p>No pending orders.</p>
        </div>
        {% endif %}
    </div>

    <div id="picked-up-orders" class="order-list is-hidden">
        {% if picked_up_orders %}
            <div class="columns is-multiline is-variable is-4">
                {% for order in picked_up_orders %}
                    <div class="column is-full-mobile is-half-tablet is-half-desktop">
                        <div class="card mb-5">
                            <div class="card-content">
                                <div class="media is-flex is-justify-content-space-between is-flex-direction-column-mobile">
                                    <div class="media-content">
                                        <p class="title is-4 is-clipped">{{ order.donation.food_item }}</p>
                                    </div>
                                    <div class="media-right mt-2-mobile">
                                        <span class="tag is-primary is-light is-medium mt-1">{{ order.order_quantity }} reserved</span>
                                    </div>
                                </div>
                                <div class="content">
                                    <div class="columns is-flex-direction-column-mobile">
                                        <div class="column is-two-thirds">
                                            <a class="button is-link is-light is-fullwidth"
                                               style="white-space: normal; word-wrap: break-word"
                                               href="https://www.google.com/maps/dir/?api=1&destination={{ order.donation.organization.address|urlencode }}"
                                               target="_blank"
                                               rel="noopener noreferrer">
                                                {{ order.donation.organization.organization_name }}
                                                <br>
                                                {{ order.donation.organization.address }}
                                            </a>
                                        </div>
                                        <div class="column is-one-third has-text-centered">
                                            <strong>Pickup by:</strong>
                                            <p>{{ order.donation.pickup_by }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <footer class="card-footer">
                                <a href="#" class="card-footer-item review-btn" data-order-id="{{ order.order_id }}">Review</a>
                                <a href="#" class="card-footer-item">Modify</a>
                                <a href="#" class="card-footer-item">Cancel</a>
                            </footer>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
        <div class="box">
            <p>No picked up orders.</p>
        </div>
        {% endif %}
    </div>

    <div id="canceled-orders" class="order-list is-hidden">
        {% if canceled_orders %}
            <div class="columns is-multiline is-variable is-4">
                {% for order in canceled_orders %}
                    <div class="column is-full-mobile is-half-tablet is-half-desktop">
                        <div class="card mb-5">
                            <div class="card-content">
                                <div class="media is-flex is-justify-content-space-between is-flex-direction-column-mobile">
                                    <div class="media-content">
                                        <p class="title is-4 is-clipped">{{ order.donation.food_item }}</p>
                                    </div>
                                    <div class="media-right mt-2-mobile">
                                        <span class="tag is-primary is-light is-medium mt-1">{{ order.order_quantity }} reserved</span>
                                    </div>
                                </div>
                                <div class="content">
                                    <div class="columns is-flex-direction-column-mobile">
                                        <div class="column is-two-thirds">
                                            <a class="button is-link is-light is-fullwidth"
                                               style="white-space: normal; word-wrap: break-word"
                                               href="https://www.google.com/maps/dir/?api=1&destination={{ order.donation.organization.address|urlencode }}"
                                               target="_blank"
                                               rel="noopener noreferrer">
                                                {{ order.donation.organization.organization_name }}
                                                <br>
                                                {{ order.donation.organization.address }}
                                            </a>
                                        </div>
                                        <div class="column is-one-third has-text-centered">
                                            <strong>Pickup by:</strong>
                                            <p>{{ order.donation.pickup_by }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <footer class="card-footer">
                                <a href="#" class="card-footer-item">Modify</a>
                                <a href="#" class="card-footer-item">Cancel</a>
                            </footer>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
        <div class="box">
            <p>No cancelled orders.</p>
        </div>
        {% endif %}
    </div>
</div>
<script>
    // JavaScript to handle tab switching
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('.tabs ul li');
        const orderLists = document.querySelectorAll('.order-list');

        tabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('is-active'));
                orderLists.forEach(list => list.classList.add('is-hidden'));

                tab.classList.add('is-active');
                orderLists[index].classList.remove('is-hidden');
            });
        });
    });
</script>
<script src="{% static 'js/review_modal.js' %}"></script>
{% endblock content %}
